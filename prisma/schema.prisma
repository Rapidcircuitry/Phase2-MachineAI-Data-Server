generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model SystemUser {
  id              Int                @id @default(autoincrement()) @map("user_id")
  fullName        String             @map("user_full_name")
  email           String             @unique @map("user_email")
  phone           String             @unique @map("user_phone")
  isActive        Boolean            @default(true) @map("is_active")
  isDeleted       Boolean            @default(false) @map("is_deleted")
  isEmailVerified Boolean            @default(false) @map("is_email_verified")
  password        String             @map("user_password")
  createdAt       DateTime           @default(now()) @map("created_at")
  updatedAt       DateTime           @updatedAt @map("updated_at")
  sessions        SystemUserSession?

  @@index([email], map: "user_email_index")
  @@index([phone], map: "user_phone_index")
  @@map("SystemUserInfo")
}

model SystemUserSession {
  id         Int        @id @default(autoincrement()) @map("session_id")
  userId     Int        @unique @map("user_id")
  token      String
  expiresAt  DateTime   @map("expires_at")
  createdAt  DateTime   @default(now()) @map("created_at")
  updatedAt  DateTime   @updatedAt @map("updated_at")
  systemUser SystemUser @relation(fields: [userId], references: [id])

  @@map("SystemUserSessionInfo")
}

model DeviceType {
  id          Int       @id @default(autoincrement()) @map("device_type_id")
  name        String    @map("device_type_name")
  description String    @map("device_type_description")
  config      Json      @map("device_type_config")
  isActive    Boolean   @default(true) @map("is_active")
  isDeleted   Boolean   @default(false) @map("is_deleted")
  createdAt   DateTime  @default(now()) @map("created_at")
  updatedAt   DateTime  @updatedAt @map("updated_at")
  devices     Devices[]

  @@map("DeviceTypeInfo")
}

model DeviceOwner {
  id        Int       @id @default(autoincrement()) @map("owner_id")
  fullName  String    @map("owner_full_name")
  email     String    @unique @map("owner_email")
  phone     String?   @unique @map("owner_phone")
  isActive  Boolean   @default(true) @map("is_active")
  isDeleted Boolean   @default(false) @map("is_deleted")
  createdAt DateTime  @default(now()) @map("created_at")
  updatedAt DateTime  @updatedAt @map("updated_at")
  devices   Devices[]

  @@index([email], map: "owner_email_index")
  @@index([phone], map: "owner_phone_index")
  @@map("DeviceOwnerInfo")
}

model Devices {
  id                Int          @id @default(autoincrement()) @map("device_id")
  name              String?      @map("device_name")
  description       String?      @map("device_description")
  macId             String       @unique @map("device_mac_id")
  chipId            String       @unique @map("device_chip_id")
  config            Json?        @map("device_custom_config")
  ioMapping         Json?        @map("device_io_mapping")
  dataInterval      Int?         @map("device_data_interval")
  lastConnectedAt   DateTime?    @map("last_connected_at")
  deviceTypeId      Int?         @map("device_type_id")
  ownerId           Int?         @map("owner_id")
  isConfigured      Boolean      @default(false) @map("is_configured")
  isPaused          Boolean      @default(false) @map("is_paused")
  isActive          Boolean      @default(false) @map("is_active")
  isDeleted         Boolean      @default(false) @map("is_deleted")
  createdAt         DateTime     @default(now()) @map("created_at")
  updatedAt         DateTime     @updatedAt @map("updated_at")
  emailScheduleTime String?      @map("device_email_schedule_time")
  recipientEmails   String[]     @map("device_recipient_emails")
  cronSchedule      String?      @map("device_cron_schedule")
  inputStates       Boolean[]    @default([false, false, false, false]) @map("device_input_states")
  outputStates      Boolean[]    @default([false, false, false, false]) @map("device_output_states")
  DeviceData        DeviceData[]
  deviceType        DeviceType?  @relation(fields: [deviceTypeId], references: [id])
  owner             DeviceOwner? @relation(fields: [ownerId], references: [id])

  @@index([macId], map: "device_mac_id_index")
  @@index([chipId], map: "device_chip_id_index")
  @@index([deviceTypeId], map: "device_type_id_index")
  @@index([ownerId], map: "owner_id_index")
  @@map("DevicesInfo")
}

model DeviceData {
  id        Int      @id @default(autoincrement()) @map("data_id")
  deviceId  Int      @map("device_id")
  data      Json     @map("data_payload")
  timestamp DateTime @default(now()) @map("data_timestamp")
  device    Devices  @relation(fields: [deviceId], references: [id])

  @@index([deviceId, timestamp], map: "device_data_deviceid_timestamp_index")
  @@map("DeviceDataInfo")
}
